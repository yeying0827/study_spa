#### 1.1 定义、一些历史和一些关注点 

单页应用： 

使用期间页面不会重新加载 

一种从Web服务器加载的富客户端 

##### 1.1.1 一些历史 

Java小程序：浏览器授权、Java插件 

Flash/Flex：Flash插件 

以上两者需要考虑开销和安全方面的顾虑 

JavaScript 

##### 1.1.2 是什么导致JavaScript单页应用姗姗来迟 

优势： 

* 不需要插件：安装、维护、兼容性 单独的安全模型 

* 不臃肿：不需要额外运行环境的插件（少得多） 

* 一种客户端语言：大大降低开发维护的复杂性 

* 更流畅和更具交互性的页面：整个窗口都是应用 

* Web浏览器：世界上最广泛使用的应用，浏览器中的JavaScript是世界上分布最广的执行环境之一 

* 部署JavaScript应用很简单：跨平台开发 

  趋于一致的跨浏览器标准实现 一些成熟的库消除了不一致性 

* JavaScript的运行速度变得惊人的快且有时能和编译型语言匹敌 

  浏览器之间的激烈竞争 -> 现代JavaScript实现利用了如即时编译（JIT）成本地机器码、分支预测、类型推断和多线程的高级优化技术。 

* JavaScript逐渐引入了高级功能：JSON原生对象、本地jQuery风格的选择器、更加一致的ajax功能，使用成熟的库 

* HTML5、SVG和CSS3的标准和支持已向前推进：完美渲染像素级别的图形 

* 整个Web项目从头到尾都可以使用JavaScript 

  JSON 

* 台式机、笔记本甚至移动设备都越来越强大 

  多核处理器、G级别内存 

生成的JavaScript：殊途同归 

著名的JavaScript生成器： 

* Google Web Toolkit（GWT）Java->JavaScript 

* Cappuccino Objective-J（Objective-C的副本、Cocoa应用框架移植） 

* CoffeeScript 自定义语言->JavaScript 

理由和反驳： 

* 熟悉度 转化丢失、问题排查 

* 框架 一致的构建库GWT 

* 多目标：兼容（单独处理） vs. 趋于一致的浏览器实现和成熟的跨浏览器库 

* 成熟度：大规模应用、结构化、类型安全的缺失 -> 结合代码验证工具、代码标准和使用成熟的库 

##### 1.1.3 我们的关注点 

```mermaid
graph LR;
A[数据库]-->B[服务器];
B-->A;
B-->C[客户端];
C-->B;
```

传统网站: 
| 数据库 | 服务器 | 客户端 |
| --- | --- | --- |
| 数据存储 |  认证 | HTML渲染 |
| 数据检索 | 授权 | 装饰性JS |
| 业务逻辑 | 验证 | --- |
| --- | 业务逻辑 | --- |
| --- | HTML生成 | --- |

单页应用： 
| 数据库 | 服务器 | 客户端 |
| --- | --- | --- |
| 数据存储 |  认证 | HTML渲染 |
| 数据检索 | 授权 | 装饰性JS |
| --- | 验证 | 业务逻辑 |
| --- | --- | HTML生成 |

#### 1.2 构建第一个单页应用 

##### 1.2.1 定义目标 

在浏览器窗口的右下角显示一个聊天滑块。当应用加载时，滑块是收起的；当点击滑块的时，它就会展开；再次点击，它又会收起来。 

##### 1.2.2 创建文件结构 

使用单个文件spa.html来创建应用，外部库只使用jQuery。 

开始时使用单个文件，方便开发和示例。 

##### 1.2.3 使用Chrome开发者工具 

Firefox: Firebug 

IE和Safari：他们自己的开发者工具 

##### 1.2.4 开发HTML和CSS 

流式布局(liquid layout)，界面按显示大小自适应，滑块总是固定在右下角。 

##### 1.2.5 添加JavaScript 

JSLint是一种JavaScript验证器，能确保代码不会破坏很多明显的JavaScript最佳写法。 

提纲： 

* 第一个脚本标签加载jQuery库 

* 第二个脚本标签包含我们自己的JavaScript 
  * 声明JSLint设置的头部。 

  * spa函数，创建和管理聊天滑块。 

    1.一个区块：声明模块变量，包括配置常量； 

    Module scope variables 

    2.一个函数：切换聊天滑块； 

    DOM method 

    3.一个接收用户点击事件的函数，会调用切换函数； 

    Event handler 

    事件处理程序：保持小而专注的处理程序。他们应该调用其他方法来更新显示或者修改业务逻辑。 

    4.一个函数：初始化应用的状态； 

    Public method 

  * 一行在浏览器DOM可用时就调用spa函数的代码。 

从CDN引入jQuery库，这会减轻服务器的负载。 

使用JSLint确保了代码不会有常见的JavaScript编码错误。 

JSLint要求函数在使用前就要声明，因此脚本是“从下往上”读取函数的，级别最高的函数在最后面。 

jQuery：缩短开发时间，减小脚本长度，提供稳健的跨浏览器功能。体积很小，很可能已经有缓存。学习成本？ 

##### 1.2.6 使用Chrome开发者工具查看应用 

开发者工具顶部菜单中的Sources按钮，点击左边的空白处添加断点。 

当应用暂停的时候，可以查看变量和元素。可以打开控制台，输入各种变量，按下回车键查看该暂停状态下他们的值。 

当查看完时，可以点击左边的空白处来移除断点，然后点击右上角的Resume按钮 -> 脚本继续执行 

[在线手册](http://mng.bz/PzIJ) 

#### 1.3 精心编写的单页应用的用户效益 

单页应用的主要好处：提供了更加吸引人的用户体验。 

桌面应用的即时性以及网站的可移植性和可访问性。 

* 可以和桌面应用一样渲染--只需重绘界面上需要变化的部分。快速渲染、即时反馈 

* 可以拥有和桌面应用一样的响应速度--尽可能地把（临时的）工作数据和处理过程从服务端转移到浏览器端。 

* 可以和桌面应用一样，把它的状态通知给用户--当必须等待服务器的响应时，可以动态地显示进度条或者繁忙指示器，因此用户不会因延时而困惑。 

* 像网络一样，几乎随处可以访问--不像大多数的桌面应用，用户可以通过任何网络连接和适当的浏览器来访问单页应用。 

* 可以像网站一样即时地更新和发布--用户只要重新加载浏览器就行了。维护软件多个并存版本的麻烦在很大程度上消除了（缓存...）。 

* 和网站一样，是跨平台的--可以在提供现代HTML5浏览器的任意操作系统上运行。 

具有互动和快速响应的界面，还伴有访问网络的功能。 

#### 1.4 小结 

总结。 

JavaScript的发展，久经考验的流行解决方案（或这些技术的替代者），JSLint，Chrome开发者工具，单页应用的优势。 